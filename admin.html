<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Noble Knight Outfit</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/CxP2JBGQ/Chat-GPT-Image-Jul-4-2025-10-08-25-PM.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <style>
        :root {
            --primary: #95C11F;
            --primary-dark: #7ca119;
            --secondary: #ff6b6b;
            --dark: #2d3748;
            --light: #f8f9fa;
            --gray: #e2e8f0;
            --dark-gray: #a0aec0;
            --danger: #e53e3e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Admin Layout */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .admin-sidebar {
            width: 250px;
            background: var(--dark);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .admin-brand {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .admin-brand h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-brand img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }
        
        .admin-menu {
            padding: 0 20px;
        }
        
        .admin-menu-item {
            margin-bottom: 5px;
        }
        
        .admin-menu-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--dark-gray);
            border-radius: 5px;
            transition: all 0.3s;
            gap: 10px;
        }
        
        .admin-menu-link:hover, .admin-menu-link.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .admin-menu-link i {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .admin-main {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--gray);
        }
        
        .admin-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .admin-logout {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Admin Cards */
        .admin-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .admin-card-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-card-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .admin-card-body {
            padding: 20px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--gray);
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px 12px;
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: var(--gray);
            color: var(--dark);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        /* File Upload */
        .file-upload-container {
            margin-bottom: 20px;
        }
        
        .file-upload-wrapper {
            position: relative;
            margin-bottom: 10px;
        }
        
        .file-upload-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray);
            border-radius: 5px;
        }
        
        .file-upload-button {
            position: absolute;
            right: 0;
            top: 0;
            padding: 10px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }
        
        .file-upload-button:hover {
            background: var(--primary-dark);
        }
        
        .file-upload-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .file-preview-item {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .file-preview-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
        }
        
        .upload-progress {
            width: 100%;
            margin-top: 10px;
            display: none;
        }
        
        /* Tables */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray);
        }
        
        .admin-table th {
            font-weight: 600;
            background: var(--light);
        }
        
        .admin-table tr:hover td {
            background: rgba(149, 193, 31, 0.05);
        }
        
        .table-actions {
            display: flex;
            gap: 5px;
        }
        
        /* Tabs */
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray);
            margin-bottom: 20px;
        }
        
        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--dark-gray);
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .admin-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #f0fff4;
            color: #2f855a;
            border: 1px solid #c6f6d5;
        }
        
        .alert-danger {
            background: #fff5f5;
            color: #c53030;
            border: 1px solid #fed7d7;
        }
        
        /* Login Form */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--light);
        }
        
        .login-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            padding: 30px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
        }
        
        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-error {
            color: var(--danger);
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .admin-sidebar {
                width: 100%;
                height: auto;
                position: relative;
                margin-bottom: 20px;
            }
            
            .admin-main {
                margin-left: 0;
            }
            
            .admin-layout {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Login Section (hidden by default if logged in) -->
    <div id="login-section" class="login-container" style="display: none;">
        <div class="login-card">
            <div class="login-logo">
                <img src="https://i.postimg.cc/CxP2JBGQ/Chat-GPT-Image-Jul-4-2025-10-08-25-PM.png" alt="Logo">
            </div>
            <h1 class="login-title">Admin Login</h1>
            <div id="login-error" class="login-error"></div>
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="login-username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="login-password" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Panel (hidden by default until logged in) -->
    <div id="admin-panel" class="admin-layout" style="display: none;">
        <!-- Sidebar -->
        <div class="admin-sidebar">
            <div class="admin-brand">
                <h2>
                    <img src="https://i.postimg.cc/CxP2JBGQ/Chat-GPT-Image-Jul-4-2025-10-08-25-PM.png" alt="Logo">
                    <span>Admin Panel</span>
                </h2>
            </div>
            <div class="admin-menu">
                <div class="admin-menu-item">
                    <a href="#" class="admin-menu-link active" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="admin-menu-item">
                    <a href="#" class="admin-menu-link" onclick="showSection('products')">
                        <i class="fas fa-shopping-bag"></i>
                        <span>Products</span>
                    </a>
                </div>
                <div class="admin-menu-item">
                    <a href="#" class="admin-menu-link" onclick="showSection('categories')">
                        <i class="fas fa-tags"></i>
                        <span>Categories</span>
                    </a>
                </div>
                <div class="admin-menu-item">
                    <a href="#" class="admin-menu-link" onclick="showSection('hero-banner')">
                        <i class="fas fa-images"></i>
                        <span>Hero Banner</span>
                    </a>
                </div>
                <div class="admin-menu-item">
                    <a href="#" class="admin-menu-link" onclick="showSection('orders')">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Orders</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="admin-main">
            <div class="admin-header">
                <div class="admin-title" id="adminSectionTitle">Dashboard</div>
                <button class="admin-logout" onclick="adminLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
            
            <!-- Alert Container -->
            <div id="alertContainer"></div>
            
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="admin-section">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div class="admin-card-title">Store Overview</div>
                    </div>
                    <div class="admin-card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div class="admin-card" style="margin-bottom: 0;">
                                <div class="admin-card-body" style="text-align: center;">
                                    <h3 style="font-size: 2rem; color: var(--primary);" id="totalProducts">0</h3>
                                    <p>Total Products</p>
                                </div>
                            </div>
                            <div class="admin-card" style="margin-bottom: 0;">
                                <div class="admin-card-body" style="text-align: center;">
                                    <h3 style="font-size: 2rem; color: var(--primary);" id="totalCategories">0</h3>
                                    <p>Total Categories</p>
                                </div>
                            </div>
                            <div class="admin-card" style="margin-bottom: 0;">
                                <div class="admin-card-body" style="text-align: center;">
                                    <h3 style="font-size: 2rem; color: var(--primary);" id="totalOrders">0</h3>
                                    <p>Total Orders</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div class="admin-card-title">Recent Orders</div>
                    </div>
                    <div class="admin-card-body">
                        <p>No recent orders</p>
                    </div>
                </div>
            </div>
            
            <!-- Products Section -->
            <div id="products-section" class="admin-section" style="display: none;">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div class="admin-card-title">Manage Products</div>
                        <button class="btn btn-primary btn-sm" onclick="showProductForm()">
                            <i class="fas fa-plus"></i>
                            <span>Add Product</span>
                        </button>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-table-responsive">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Name</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <!-- Products will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Product Form -->
                <div class="admin-card" id="productFormContainer" style="display: none;">
                    <div class="admin-card-header">
                        <div class="admin-card-title" id="productFormTitle">Add New Product</div>
                    </div>
                    <div class="admin-card-body">
                        <form id="productForm">
                            <input type="hidden" id="productId">
                            
                            <div class="form-group">
                                <label class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select class="form-control form-select" id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <!-- Categories will be loaded here -->
                                </select>
                                <small class="text-muted">Can't find your category? <a href="#" onclick="showSection('categories')">Add new category</a></small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Collection</label>
                                <select class="form-control form-select" id="productCollection" required>
                                    <option value="bags">Bags</option>
                                    <option value="wallets">Wallets</option>
                                    <option value="belts">Belts</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Price (EGP)</label>
                                <input type="number" class="form-control" id="productPrice" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Old Price (EGP)</label>
                                <input type="number" class="form-control" id="productOldPrice">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Product Images</label>
                                <div class="file-upload-wrapper">
                                    <input type="file" id="productImagesUpload" multiple style="display: none;" onchange="uploadProductImages(this)">
                                    <button type="button" class="file-upload-button" onclick="document.getElementById('productImagesUpload').click()">
                                        <i class="fas fa-upload"></i>
                                        <span>Upload Images</span>
                                    </button>
                                </div>
                                <div class="file-upload-preview" id="productImagesPreview"></div>
                                <progress id="productImagesProgress" class="upload-progress" value="0" max="100"></progress>
                                <input type="hidden" id="productImages">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-control form-textarea" id="productDescription" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Size & Fit Details</label>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                                    <div>
                                        <label class="form-label">Depth (cm)</label>
                                        <input type="text" class="form-control" id="productDepth">
                                    </div>
                                    <div>
                                        <label class="form-label">Width (cm)</label>
                                        <input type="text" class="form-control" id="productWidth">
                                    </div>
                                    <div>
                                        <label class="form-label">Height (cm)</label>
                                        <input type="text" class="form-control" id="productHeight">
                                    </div>
                                    <div>
                                        <label class="form-label">Handle Length (cm)</label>
                                        <input type="text" class="form-control" id="productHandle">
                                    </div>
                                    <div>
                                        <label class="form-label">Strap Length (cm)</label>
                                        <input type="text" class="form-control" id="productStrap">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="productNewArrival">
                                    <span>Mark as New Arrival</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="productDiscount">
                                    <span>Mark as Discount</span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; gap: 10px;">
                                <button type="button" class="btn btn-primary" onclick="saveProduct()">
                                    <i class="fas fa-save"></i>
                                    <span>Save Product</span>
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="cancelProductForm()">
                                    <i class="fas fa-times"></i>
                                    <span>Cancel</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Categories Section -->
            <div id="categories-section" class="admin-section" style="display: none;">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div class="admin-card-title">Manage Categories</div>
                        <button class="btn btn-primary btn-sm" onclick="showCategoryForm()">
                            <i class="fas fa-plus"></i>
                            <span>Add Category</span>
                        </button>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-table-responsive">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Products</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="categoriesTableBody">
                                    <!-- Categories will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Category Form -->
                <div class="admin-card" id="categoryFormContainer" style="display: none;">
                    <div class="admin-card-header">
                        <div class="admin-card-title" id="categoryFormTitle">Add New Category</div>
                    </div>
                    <div class="admin-card-body">
                        <form id="categoryForm">
                            <div class="form-group">
                                <label class="form-label">Category Name</label>
                                <input type="text" class="form-control" id="categoryName" required>
                            </div>
                            
                            <div class="form-group" style="display: flex; gap: 10px;">
                                <button type="button" class="btn btn-primary" onclick="saveCategory()">
                                    <i class="fas fa-save"></i>
                                    <span>Save Category</span>
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="cancelCategoryForm()">
                                    <i class="fas fa-times"></i>
                                    <span>Cancel</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Hero Banner Section -->
            <div id="hero-banner-section" class="admin-section" style="display: none;">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div class="admin-card-title">Hero Banner Slides</div>
                        <button class="btn btn-primary btn-sm" onclick="addNewHeroSlide()">
                            <i class="fas fa-plus"></i>
                            <span>Add Slide</span>
                        </button>
                    </div>
                    <div class="admin-card-body">
                        <div id="heroSlidesContainer">
                            <!-- Hero slides will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Orders Section -->
            <div id="orders-section" class="admin-section" style="display: none;">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div class="admin-card-title">Manage Orders</div>
                    </div>
                    <div class="admin-card-body">
                        <p>No orders found</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB1QeRzYbB8n4L7Q9Q5Y4X4Z4X4Z4X4Z4X",
            authDomain: "test-1d0cc.firebaseapp.com",
            databaseURL: "https://test-1d0cc-default-rtdb.firebaseio.com",
            projectId: "test-1d0cc",
            storageBucket: "test-1d0cc.appspot.com",
            messagingSenderId: "1234567890",
            appId: "1:1234567890:web:abcdef1234567890"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const productsRef = database.ref('products');
        const categoriesRef = database.ref('categories');
        const heroSlidesRef = database.ref('heroSlides');
        const ordersRef = database.ref('orders');

        // Admin credentials
        const ADMIN_CREDENTIALS = {
            username: "admin",
            password: "admin8200"
        };

        // Current data
        let products = [];
        let categories = [];
        let heroSlides = [];
        let orders = [];
        let isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';

        // Check authentication status on page load
        function checkAuth() {
            if (isAdminLoggedIn) {
                // Show admin panel
                document.getElementById('admin-panel').style.display = 'flex';
                document.getElementById('login-section').style.display = 'none';
                
                // Load all data
                loadProducts();
                loadCategories();
                loadHeroSlides();
                loadOrders();
            } else {
                // Show login form
                document.getElementById('admin-panel').style.display = 'none';
                document.getElementById('login-section').style.display = 'flex';
            }
        }

        // Login form submission
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                // Successful login
                localStorage.setItem('adminLoggedIn', 'true');
                isAdminLoggedIn = true;
                checkAuth();
            } else {
                // Failed login
                document.getElementById('login-error').textContent = 'Invalid username or password';
            }
        });

        // Show alert message
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            alertContainer.appendChild(alert);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Show section
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`${sectionId}-section`).style.display = 'block';
            
            // Update active menu item
            document.querySelectorAll('.admin-menu-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find the menu item that matches the section and activate it
            const menuItem = Array.from(document.querySelectorAll('.admin-menu-link')).find(item => {
                return item.getAttribute('onclick').includes(`'${sectionId}'`);
            });
            
            if (menuItem) {
                menuItem.classList.add('active');
            }
            
            // Update title
            const sectionTitles = {
                'dashboard': 'Dashboard',
                'products': 'Manage Products',
                'categories': 'Manage Categories',
                'hero-banner': 'Hero Banner',
                'orders': 'Manage Orders'
            };
            
            document.getElementById('adminSectionTitle').textContent = sectionTitles[sectionId];
            
            // Reset forms if showing products or categories
            if (sectionId === 'products') {
                cancelProductForm();
            } else if (sectionId === 'categories') {
                cancelCategoryForm();
            }
        }

        // Load products
        function loadProducts() {
            productsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                products = [];
                if (data) {
                    for (let id in data) {
                        products.push({
                            id: id,
                            ...data[id]
                        });
                    }
                }
                renderProducts();
                updateDashboardCounts();
            });
        }

        // Load categories
        function loadCategories() {
            categoriesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                categories = data || [];
                renderCategories();
                updateDashboardCounts();
            });
        }

        // Load hero slides
        function loadHeroSlides() {
            heroSlidesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                heroSlides = data || [
                    {
                        image: "https://i.postimg.cc/CxP2JBGQ/Chat-GPT-Image-Jul-4-2025-10-08-25-PM.png",
                        title: "Luxury Coach Bags",
                        description: "Elevate your style with our premium Coach bag collection",
                        buttonText: "Shop Now"
                    },
                    {
                        image: "https://i.postimg.cc/KcLSdD5B/511172410-1131850709160359-3044113433936647230-n.jpg",
                        title: "Brooklyn Shoulder Bag",
                        description: "Classic design meets modern luxury",
                        buttonText: "Shop Bags"
                    },
                    {
                        image: "https://i.postimg.cc/sDk2BcTf/513189979-1225415772158288-6210767396290395887-n.jpg",
                        title: "Tabby Shoulder Bag",
                        description: "Timeless elegance with contemporary flair",
                        buttonText: "Shop Now"
                    }
                ];
                renderHeroSlides();
            });
        }

        // Load orders
        function loadOrders() {
            ordersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                orders = [];
                if (data) {
                    for (let id in data) {
                        orders.push({
                            id: id,
                            ...data[id]
                        });
                    }
                }
                updateDashboardCounts();
            });
        }

        // Update dashboard counts
        function updateDashboardCounts() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalCategories').textContent = categories.length;
            document.getElementById('totalOrders').textContent = orders.length;
        }

        // Render products
        function renderProducts() {
            const tableBody = document.getElementById('productsTableBody');
            tableBody.innerHTML = '';
            
            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center;">No products found</td>
                    </tr>
                `;
                return;
            }
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <img src="${product.image}" alt="${product.title}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                    </td>
                    <td>${product.title}</td>
                    <td>${product.category || '-'}</td>
                    <td>${product.price.toLocaleString()} EGP</td>
                    <td>
                        ${product.isNewArrival ? '<span style="background: var(--primary); color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8rem;">New</span>' : ''}
                        ${product.discount ? '<span style="background: var(--secondary); color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8rem; margin-left: 5px;">Sale</span>' : ''}
                    </td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-primary btn-sm" onclick="editProduct('${product.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct('${product.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Render categories
        function renderCategories() {
            const tableBody = document.getElementById('categoriesTableBody');
            tableBody.innerHTML = '';
            
            // Also update the category dropdown in product form
            const categorySelect = document.getElementById('productCategory');
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            
            if (categories.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="3" style="text-align: center;">No categories found</td>
                    </tr>
                `;
                return;
            }
            
            categories.forEach(category => {
                // Add to categories table
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category}</td>
                    <td>${products.filter(p => p.category === category).length}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-danger btn-sm" onclick="deleteCategory('${category}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Add to product form dropdown
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // Render hero slides
        function renderHeroSlides() {
            const container = document.getElementById('heroSlidesContainer');
            container.innerHTML = '';
            
            heroSlides.forEach((slide, index) => {
                const slideNum = index + 1;
                const slideCard = document.createElement('div');
                slideCard.className = 'admin-card';
                slideCard.style.marginBottom = '20px';
                slideCard.innerHTML = `
                    <div class="admin-card-header">
                        <div class="admin-card-title">Slide ${slideNum}</div>
                    </div>
                    <div class="admin-card-body">
                        <div class="form-group">
                            <label class="form-label">Image</label>
                            <img src="${slide.image}" alt="Slide ${slideNum}" style="max-width: 100%; height: 150px; object-fit: contain; margin-bottom: 10px; display: block;">
                            <div class="file-upload-wrapper">
                                <input type="file" id="hero-slide-${slideNum}-upload" style="display: none;" onchange="uploadHeroSlideImage(this, ${slideNum})">
                                <button type="button" class="file-upload-button" onclick="document.getElementById('hero-slide-${slideNum}-upload').click()">
                                    <i class="fas fa-upload"></i>
                                    <span>Change Image</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="hero-slide-${slideNum}-title" value="${slide.title}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <input type="text" class="form-control" id="hero-slide-${slideNum}-desc" value="${slide.description}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Button Text</label>
                            <input type="text" class="form-control" id="hero-slide-${slideNum}-btn" value="${slide.buttonText}">
                        </div>
                        
                        <div class="form-group" style="display: flex; justify-content: space-between;">
                            <button class="btn btn-primary" onclick="updateHeroSlide(${slideNum})">
                                <i class="fas fa-save"></i>
                                <span>Update Slide</span>
                            </button>
                            ${heroSlides.length > 1 ? `
                            <button class="btn btn-danger" onclick="removeHeroSlide(${slideNum})">
                                <i class="fas fa-trash"></i>
                                <span>Remove Slide</span>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(slideCard);
            });
        }

        // Show product form
        function showProductForm(productId = null) {
            document.getElementById('productFormContainer').style.display = 'block';
            document.getElementById('productFormTitle').textContent = productId ? 'Edit Product' : 'Add New Product';
            document.getElementById('productId').value = productId || '';
            
            if (productId) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('productName').value = product.title;
                    document.getElementById('productCategory').value = product.category || '';
                    document.getElementById('productCollection').value = product.collection || 'bags';
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productOldPrice').value = product.oldPrice || '';
                    document.getElementById('productDescription').value = product.description;
                    document.getElementById('productNewArrival').checked = product.isNewArrival || false;
                    document.getElementById('productDiscount').checked = product.discount || false;
                    
                    // Size & fit details
                    if (product.sizeFit) {
                        document.getElementById('productDepth').value = product.sizeFit.depth || '';
                        document.getElementById('productWidth').value = product.sizeFit.width || '';
                        document.getElementById('productHeight').value = product.sizeFit.height || '';
                        document.getElementById('productHandle').value = product.sizeFit.handle || '';
                        document.getElementById('productStrap').value = product.sizeFit.strap || '';
                    }
                    
                    // Images
                    const previewContainer = document.getElementById('productImagesPreview');
                    previewContainer.innerHTML = '';
                    
                    const productImages = product.images || [product.image];
                    productImages.forEach(image => {
                        if (image) {
                            const previewItem = document.createElement('div');
                            previewItem.className = 'file-preview-item';
                            previewItem.innerHTML = `
                                <img src="${image}">
                                <div class="file-preview-remove" onclick="removeProductImage('${image}', this.parentElement)">
                                    <i class="fas fa-times"></i>
                                </div>
                            `;
                            previewContainer.appendChild(previewItem);
                        }
                    });
                    
                    document.getElementById('productImages').value = productImages.join(',');
                }
            } else {
                // Reset form for new product
                document.getElementById('productForm').reset();
                document.getElementById('productImagesPreview').innerHTML = '';
                document.getElementById('productImages').value = '';
            }
            
            // Scroll to form
            document.getElementById('productFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // Cancel product form
        function cancelProductForm() {
            document.getElementById('productFormContainer').style.display = 'none';
            document.getElementById('productForm').reset();
            document.getElementById('productImagesPreview').innerHTML = '';
            document.getElementById('productImages').value = '';
        }

        // Save product
        function saveProduct() {
            const id = document.getElementById('productId').value;
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const collection = document.getElementById('productCollection').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const oldPrice = parseFloat(document.getElementById('productOldPrice').value) || null;
            const description = document.getElementById('productDescription').value;
            const isNewArrival = document.getElementById('productNewArrival').checked;
            const discount = document.getElementById('productDiscount').checked;
            
            // Size & fit details
            const sizeFit = {
                depth: document.getElementById('productDepth').value,
                width: document.getElementById('productWidth').value,
                height: document.getElementById('productHeight').value,
                handle: document.getElementById('productHandle').value,
                strap: document.getElementById('productStrap').value
            };
            
            // Get images
            const imagesText = document.getElementById('productImages').value;
            const images = imagesText.split(',').filter(img => img.trim() !== '');
            
            if (!name || !category || !collection || isNaN(price)) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }
            
            const productData = {
                title: name,
                category,
                collection,
                price,
                oldPrice,
                image: images.length > 0 ? images[0] : '', // First image is main image
                images,
                description,
                isNewArrival,
                discount,
                sizeFit
            };
            
            if (id) {
                // Update existing product
                productsRef.child(id).update(productData)
                    .then(() => {
                        showAlert('Product updated successfully!');
                        cancelProductForm();
                    })
                    .catch(error => {
                        showAlert('Error updating product: ' + error.message, 'danger');
                    });
            } else {
                // Add new product
                productsRef.push(productData)
                    .then(() => {
                        showAlert('Product added successfully!');
                        cancelProductForm();
                    })
                    .catch(error => {
                        showAlert('Error adding product: ' + error.message, 'danger');
                    });
            }
        }

        // Edit product
        function editProduct(productId) {
            showProductForm(productId);
        }

        // Delete product
        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                productsRef.child(productId).remove()
                    .then(() => {
                        showAlert('Product deleted successfully!');
                    })
                    .catch(error => {
                        showAlert('Error deleting product: ' + error.message, 'danger');
                    });
            }
        }

        // Upload product images
        function uploadProductImages(input) {
            const files = input.files;
            if (!files || files.length === 0) return;
            
            const previewContainer = document.getElementById('productImagesPreview');
            const progressBar = document.getElementById('productImagesProgress');
            progressBar.style.display = 'block';
            progressBar.value = 0;
            
            const existingImages = document.getElementById('productImages').value.split(',').filter(img => img.trim() !== '');
            const newImages = [...existingImages];
            let uploadedCount = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Show preview immediately
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'file-preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}">
                        <div class="file-preview-remove" onclick="removeProductImage('${e.target.result}', this.parentElement)">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    previewContainer.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
                
                // Upload to ImageBB
                uploadImageToImageBB(file)
                    .then(url => {
                        newImages.push(url);
                        uploadedCount++;
                        progressBar.value = (uploadedCount / files.length) * 100;
                        
                        if (uploadedCount === files.length) {
                            // All files uploaded
                            document.getElementById('productImages').value = newImages.join(',');
                            progressBar.style.display = 'none';
                        }
                    })
                    .catch(error => {
                        console.error('Upload failed:', error);
                        uploadedCount++;
                        progressBar.value = (uploadedCount / files.length) * 100;
                    });
            }
        }

        // Remove product image
        function removeProductImage(imageUrl, element) {
            const imagesText = document.getElementById('productImages').value;
            const images = imagesText.split(',').filter(img => img.trim() !== '' && img !== imageUrl);
            document.getElementById('productImages').value = images.join(',');
            element.remove();
        }

        // Upload image to ImageBB
        async function uploadImageToImageBB(file) {
            const formData = new FormData();
            formData.append('image', file);
            
            const response = await fetch('https://api.imgbb.com/1/upload?key=66eb52bb083a381a7541a59b74c0ddf2', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                return result.data.url;
            } else {
                throw new Error('Image upload failed');
            }
        }

        // Show category form
        function showCategoryForm(categoryName = '') {
            document.getElementById('categoryFormContainer').style.display = 'block';
            document.getElementById('categoryFormTitle').textContent = categoryName ? 'Edit Category' : 'Add New Category';
            document.getElementById('categoryName').value = categoryName;
            
            // Scroll to form
            document.getElementById('categoryFormContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // Cancel category form
        function cancelCategoryForm() {
            document.getElementById('categoryFormContainer').style.display = 'none';
            document.getElementById('categoryForm').reset();
        }

        // Save category
        function saveCategory() {
            const name = document.getElementById('categoryName').value.trim();
            
            if (!name) {
                showAlert('Please enter category name', 'danger');
                return;
            }
            
            // Check if category already exists
            if (categories.includes(name)) {
                showAlert('Category already exists', 'danger');
                return;
            }
            
            // Add to categories array
            const newCategories = [...categories, name];
            
            // Update Firebase
            categoriesRef.set(newCategories)
                .then(() => {
                    showAlert('Category added successfully!');
                    cancelCategoryForm();
                })
                .catch(error => {
                    showAlert('Error adding category: ' + error.message, 'danger');
                });
        }

        // Delete category
        function deleteCategory(categoryName) {
            if (confirm(`Are you sure you want to delete the category "${categoryName}"? This will remove it from all products.`)) {
                // Remove from categories array
                const newCategories = categories.filter(c => c !== categoryName);
                
                // Update products that have this category
                const updates = {};
                products.forEach(product => {
                    if (product.category === categoryName) {
                        updates[`${product.id}/category`] = '';
                    }
                });
                
                // First update products
                if (Object.keys(updates).length > 0) {
                    productsRef.update(updates)
                        .then(() => {
                            // Then update categories
                            categoriesRef.set(newCategories)
                                .then(() => {
                                    showAlert('Category deleted successfully!');
                                })
                                .catch(error => {
                                    showAlert('Error updating categories: ' + error.message, 'danger');
                                });
                        })
                        .catch(error => {
                            showAlert('Error updating products: ' + error.message, 'danger');
                        });
                } else {
                    // Just update categories if no products to update
                    categoriesRef.set(newCategories)
                        .then(() => {
                            showAlert('Category deleted successfully!');
                        })
                        .catch(error => {
                            showAlert('Error updating categories: ' + error.message, 'danger');
                        });
                }
            }
        }

        // Update hero slide
        function updateHeroSlide(slideNumber) {
            const slideIndex = slideNumber - 1;
            if (slideIndex >= heroSlides.length) return;
            
            const title = document.getElementById(`hero-slide-${slideNumber}-title`).value;
            const description = document.getElementById(`hero-slide-${slideNumber}-desc`).value;
            const buttonText = document.getElementById(`hero-slide-${slideNumber}-btn`).value;
            
            // Keep the existing image unless it was changed
            const existingSlide = heroSlides[slideIndex];
            const image = document.getElementById(`hero-slide-${slideNumber}-image`) ? 
                          document.getElementById(`hero-slide-${slideNumber}-image`).value : 
                          existingSlide.image;
            
            heroSlides[slideIndex] = {
                image,
                title,
                description,
                buttonText
            };
            
            // Update Firebase
            heroSlidesRef.set(heroSlides)
                .then(() => {
                    showAlert('Hero slide updated successfully!');
                })
                .catch(error => {
                    showAlert('Error updating hero slide: ' + error.message, 'danger');
                });
        }

        // Upload hero slide image
        async function uploadHeroSlideImage(input, slideNumber) {
            const file = input.files[0];
            if (!file) return;
            
            try {
                const url = await uploadImageToImageBB(file);
                
                // Create a hidden input to store the new image URL
                let imageInput = document.getElementById(`hero-slide-${slideNumber}-image`);
                if (!imageInput) {
                    imageInput = document.createElement('input');
                    imageInput.type = 'hidden';
                    imageInput.id = `hero-slide-${slideNumber}-image`;
                    input.parentNode.appendChild(imageInput);
                }
                
                imageInput.value = url;
                
                // Update the preview
                const preview = input.parentNode.previousElementSibling.querySelector('img');
                if (preview) {
                    preview.src = url;
                }
                
                showAlert('Image uploaded successfully!');
            } catch (error) {
                console.error('Upload failed:', error);
                showAlert('Image upload failed: ' + error.message, 'danger');
            }
        }

        // Add new hero slide
        function addNewHeroSlide() {
            if (heroSlides.length >= 5) {
                showAlert('Maximum of 5 slides allowed', 'danger');
                return;
            }
            
            heroSlides.push({
                image: "https://via.placeholder.com/1200x600?text=New+Slide",
                title: "New Collection",
                description: "Discover our latest arrivals",
                buttonText: "Shop Now"
            });
            
            // Update Firebase
            heroSlidesRef.set(heroSlides)
                .then(() => {
                    showAlert('New hero slide added!');
                    renderHeroSlides();
                })
                .catch(error => {
                    showAlert('Error adding hero slide: ' + error.message, 'danger');
                });
        }

        // Remove hero slide
        function removeHeroSlide(slideNumber) {
            if (heroSlides.length <= 1) {
                showAlert('You must have at least one hero slide', 'danger');
                return;
            }
            
            heroSlides.splice(slideNumber - 1, 1);
            
            // Update Firebase
            heroSlidesRef.set(heroSlides)
                .then(() => {
                    showAlert('Hero slide removed!');
                    renderHeroSlides();
                })
                .catch(error => {
                    showAlert('Error removing hero slide: ' + error.message, 'danger');
                });
        }

        // Admin logout
        function adminLogout() {
            localStorage.removeItem('adminLoggedIn');
            isAdminLoggedIn = false;
            checkAuth();
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            
            if (isAdminLoggedIn) {
                // Show dashboard by default
                showSection('dashboard');
            }
        });
    </script>
</body>
</html>
